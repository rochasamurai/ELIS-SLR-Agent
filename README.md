# ELIS SLR Agent — Project Overview, Data Contract, and CI

**Audience:** Project Managers and contributors  
**Language:** UK English  
**Scope:** Operational data (Rows), schemas, validator, and CI automation for a reproducible SLR workflow

---

## 1) What this project does (plain language)

The ELIS SLR Agent standardises and automates parts of a Systematic Literature Review (SLR).  
It enforces a frozen Data Contract so that every output file produced by the workflow is:
- structured the same way,
- validated automatically,
- version-controlled and auditable.

This gives the project team repeatability, quality control, and clear governance over changes.

---

## 2) Repository structure (high level)

- `docs/` — Specifications, plans, glossaries, and governance notes.
- `json_jsonl/` — Runtime artefacts (A/B/C datasets, logs, reports).
- `schemas/` — JSON Schemas for all validated artefacts.
- `scripts/` — Utilities and entry points (validator, toy agent runner).
- `validation_reports/` — Markdown validation reports generated by automation.
- `.github/workflows/` — GitHub Actions workflows (CI and helper automations).
- `requirements.txt` — Pinned Python toolset for local runs and CI.

---

## 3) Operating principles

- Be decisive and objective: propose one best next action per change set.
- Keep changes small and reviewable (prefer one file per commit).
- Documentation and comments in UK English.
- Code style: Black (format) and Ruff (lint). CI must stay green.
- Governance: changes flow via Pull Request → squash & merge → delete the head branch.
- Branches: `main` is protected; `elis-bot` is the automation playground (PR source).

---

## 4) Data Contract and validation policies

- Every `*_rows.json` file is a top-level JSON array.
- Only fields defined in the relevant schema are allowed (`additionalProperties: false`).
- Codebook (Appendix E) is a JSON array; each item must match its schema.
- Timestamps use ISO 8601 (UTC). Free text uses UK English.
- Authoring configs (`*_config.json`) are not consumed at runtime.

**Local validation (before opening a PR):**
```bash
python -m pip install -r requirements.txt
python scripts/validate_json.py --strict
```

---

## 5) CI model (rules)

Stage order: **quality → tests → validate**

- **quality**: Ruff + Black (check) — fails on any style issue.
- **tests**: `pytest` runs only if `tests/**/*.py` exists. Exit code 5 (“no tests found”) is treated as success. Real test failures block the PR.
- **validate**: Always runs. Non-blocking by policy, but produces a Markdown report and must be addressed. The report is committed via PR when generated.

Workflow files keep `name:` on line 1. Prefer `workflow_dispatch` triggers unless a strong reason exists to auto-trigger. Avoid unsupported expressions in conditions; prefer explicit shell checks.

---

## 6) Workflows (catalogue)

1. **ELIS – Agent Run** (`.github/workflows/agent-run.yml`)  
   Runs the toy agent (`scripts/agent.py`) in read-only mode. Uploads A/B/C JSON artefacts from `json_jsonl/`. Diagnostics-only; never commits.

2. **ELIS – Autoformat** (`.github/workflows/autoformat.yml`)  
   Runs Black on `elis-bot`, commits `chore(format): apply Black autoformat`, prints the commit SHA, and (re)opens a PR to `main` if changes exist.

3. **ELIS – Bot Commit** (`.github/workflows/bot-commit.yml`)  
   Writes or updates a file on `elis-bot` using a GitHub App token. Typical inputs: `file_path`, `content_raw`, `commit_message`, `open_pr`.

4. **ELIS – CI** (`.github/workflows/ci.yml`)  
   Pull requests to `main` and manual runs. Jobs: quality (required), tests (conditional), validate (non-blocking). `validate` depends on quality (and tests when present).

5. **ELIS – Deep Review** (`.github/workflows/deep-review.yml`)  
   Optional heavy gate for high-risk changes: typing, security, dependency audit, and coverage. Not required by branch protection.

6. **ELIS – Export Docx** (`.github/workflows/export-docx.yml`)  
   Converts a Markdown document to `.docx` on `elis-bot` (Pandoc) and opens or refreshes a PR to `main`.

7. **ELIS – Housekeeping** (`.github/workflows/housekeeping.yml`)  
   Cleans completed workflow runs and old artefacts. Supports a safe `dry_run` mode and a weekly schedule.

8. **ELIS – Projects Auto-Add** (`.github/workflows/projects-auto-add.yml`)  
   Applies repository Projects metadata to PRs (labels/fields/status). Pure metadata; never edits source files.

9. **ELIS – Projects Run ID** (`.github/workflows/projects-run-id.yml`)  
   Generates a unique Run ID and persists it to a known path (for traceability in Projects and Issues).

10. **ELIS – Validate** (`.github/workflows/elis-validate.yml`)  
    Ensures a Markdown validation report exists under `validation_reports/`. Uploads as an artefact and opens a dedicated PR (`ci/validation-report`). Attempts squash-merge; if review is required, leaves the PR open with a notice.

---

## 7) How to request actions (for non-programmers)

From the repository page:
1. Open the Actions tab.  
2. Choose a workflow from the list (for example, ELIS – Validate).  
3. Select **Run workflow**.  
4. Adjust inputs if the workflow allows it (for example, a Markdown file path for Export Docx).  
5. Press **Run workflow** and wait for the job to complete.  
6. Review the run logs and any PR that may have been opened automatically.

Tip: For small documentation or config edits, prefer **ELIS – Bot Commit** to update a single file on `elis-bot` and open a PR.

---

## 8) Default next-step playbook

- **Docs or config tweak:** Run ELIS – Bot Commit (to `elis-bot`, open PR). Let ELIS – CI run, then squash & merge.
- **Formatting drift:** Run ELIS – Autoformat, then merge the PR it opens.
- **Agent adjustment:** Edit `scripts/agent.py`. If applicable, seed minimal tests under `tests/`. Open a PR and let ELIS – CI run.
- **Health or release gate:** Run ELIS – Deep Review and ELIS – Validate. If the results are satisfactory, proceed to tag and announce.

---

## 9) Governance and branch protection

- Protected branch: `main`.
- Required checks: `quality` and `validate`.  
  The `tests` job runs only when test files are present.
- Pull requests use squash & merge, followed by auto-deletion of the head branch.
- The `elis-bot` branch is dedicated to automation-driven edits and PR sources.

---

## 10) Local developer setup (optional)

```bash
python -m pip install -r requirements.txt
ruff check .
black --check .
# or to format locally:
black .
# tests (if present):
pytest -q
# schema validation:
python scripts/validate_json.py --strict
```

---

## 11) Roadmap (high level)

- Foundation: repository scaffolding, schemas, validator, baseline CI.  
- Spec-aligned examples: populate A–C examples consistent with the Data Contract.  
- End-to-end smoke test: toy run A → B → C with full validation.  
- Pilot run: real topic, end-to-end outputs, KPIs tracked.  
- Hardening: expand tests, add pre-commit hooks, tighten branch rules.  
- Scaling: scheduled runs, richer analysis support, multilingual capabilities.

---

## 12) Contact and licensing

- Contact: instituto dot voto dot legal at gmail dot com  
- Licensing: refer to the repository’s licence file or project owner instructions. If no licence is present, treat the contents as restricted to the project team.
