# PE0b Validator Review (Codex)

Verdict: FAIL
Date: 2026-02-13
Branch: feature/pe0b-migrate-mvp

## Commands run
- `git status -sb`
- `git rev-parse --abbrev-ref HEAD`
- `git diff --stat origin/release/2.0..HEAD`
- `python -m pip install -e .`
- `python -m elis --help`
- `elis --help`
- `elis search --help`
- `elis screen --help`
- `elis validate --help`
- `ruff check .`
- `black --check .`
- `python -m pytest -q`
- `rg -n "search_mvp\.py|screen_mvp\.py|ELIS_Appendix_A_Search|Appendix_B" .`
- `elis search --config config/elis_search_queries.yml --dry-run`
- `elis screen --input json_jsonl/ELIS_Appendix_A_Search_rows.json --dry-run`
- `python -c "import elis; import elis.pipeline.search, elis.pipeline.screen, elis.pipeline.validate; print('OK')"`
- `elis search --config DOES_NOT_EXIST.yml; Write-Output "EXIT:$LASTEXITCODE"`
- `elis validate DOES_NOT_EXIST.json; Write-Output "EXIT:$LASTEXITCODE"`
- `elis validate --help; Write-Output "EXIT:$LASTEXITCODE"`
- `python -m elis --help; Write-Output "EXIT:$LASTEXITCODE"`
- `rg -n "datetime\.utcnow\(\)|utcnow\(" elis scripts tests`
- `rg -n "print\(|logging\.basicConfig|sys\.exit" elis`

## Key outputs
- `git status -sb`: `## feature/pe0b-migrate-mvp...origin/feature/pe0b-migrate-mvp` plus untracked `.claude/`.
- `git diff --stat origin/release/2.0..HEAD`: 11 files changed, 1706 insertions, 2 deletions.
- `python -m pip install -e .`: success.
- `python -m elis --help`: FAIL (`No module named elis.__main__`), `EXIT:1`.
- `elis --help`: success; shows `search`, `screen`, `validate`.
- `elis validate --help`: incorrectly runs validation, writes reports, `EXIT:0`.
- `ruff check .`: `All checks passed!`
- `black --check .`: `66 files would be left unchanged.`
- `python -m pytest -q`: all tests passed (`123 passed`) with 8 `datetime.utcnow()` deprecation warnings.
- Smoke:
  - `elis search --config config/elis_search_queries.yml --dry-run`: FAIL (`KeyError: 'id'`).
  - `elis screen --input json_jsonl/ELIS_Appendix_A_Search_rows.json --dry-run`: success.
- Importability: `OK`.

## Blocking issues
1. Missing module entrypoint for `python -m elis`.
   - Evidence: `python -m elis --help` fails.
   - References: `pyproject.toml:20` defines script entrypoint only; package has no `elis/__main__.py`.
   - Plan impact: violates PE0 acceptance (`python -m elis ... works`, `docs/_active/RELEASE_PLAN_v2.0.md:161`, `docs/_active/RELEASE_PLAN_v2.0.md:183`).

2. `elis validate --help` does not provide help and performs side effects.
   - Evidence: command executes validation, updates `validation_reports/validation-report.md`, creates timestamped reports.
   - References: `elis/cli.py:54` dispatches argv to `validate_main`, but `elis/pipeline/validate.py:128` ignores `argv` and has no argparse/help path.
   - Impact: CLI contract regression and unsafe behavior for help invocations.

3. `elis validate` ignores user-provided path arguments.
   - Evidence: `elis validate DOES_NOT_EXIST.json` still validates default A/B/C files and exits 0.
   - References: `elis/pipeline/validate.py:130-142` hardcodes appendices; no argument parsing.
   - Plan impact: does not meet `elis validate <path>` contract in release plan (`docs/_active/RELEASE_PLAN_v2.0.md:52`, `docs/_active/RELEASE_PLAN_v2.0.md:182`).

## Non-blocking risks
- Legacy config compatibility issue observed in smoke test:
  - `config/elis_search_queries.yml` topics use `name` not `id` (`config/elis_search_queries.yml:81`), while search requires `topic["id"]` (`elis/pipeline/search.py:428`), causing `KeyError`.
  - Legacy script appears to share same assumption (`scripts/elis/search_mvp.py:541`), so this may be pre-existing rather than introduced here.
- Determinism warning:
  - Runtime timestamps and `datetime.utcnow()` are used in search/screen (`elis/pipeline/search.py:43`, `elis/pipeline/search.py:418`, `elis/pipeline/screen.py:30`), and pytest surfaces deprecation warnings.

## Backward compatibility check (`scripts/`)
- `git diff --name-status origin/release/2.0..HEAD` shows no edits to `scripts/`; no deletions/renames detected.

## Verdict
FAIL. Do not merge until the CLI entrypoint and `validate` subcommand behavior are corrected.
